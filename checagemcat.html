<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checagem | Arena Competidor</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f9fa;
            margin: 0;
            padding: 0;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background-color: #000;
            color: #fff;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 250px;
            height: auto;
            margin-right: 15px;
        }

        .main-container {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .checagem-container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            border-top: 5px solid #dc3545;
            text-align: center;
        }

        .checagem-container h1 {
            color: #dc3545;
            margin-bottom: 30px;
        }

        .filtros {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .filtros label {
            font-weight: bold;
            color: #555;
        }

        .filtros select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
        }

        .category-title {
            background-color: #dc3545;
            color: #fff;
            font-weight: bold;
            padding: 10px;
            margin-top: 30px;
            border-radius: 5px;
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
            color: #555;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .sexo-title {
            background-color: #000;
            color: #fff;
            font-weight: bold;
            padding: 15px;
            margin-top: 40px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.5em;
        }

        /* --- Estilos para dispositivos móveis --- */
        @media screen and (max-width: 768px) {
            .header {
                flex-direction: column;
                padding: 10px;
                justify-content: center;
            }

            .logo {
                width: 180px;
                margin-right: 0;
            }

            .main-container {
                padding: 10px;
            }

            .checagem-container {
                padding: 15px;
                box-shadow: none;
            }

            .checagem-container h1 {
                font-size: 1.5em;
            }

            .sexo-title {
                font-size: 1.2em;
                padding: 10px;
            }

            .category-title {
                font-size: 1em;
                padding: 8px;
            }
            
            .filtros {
                flex-direction: column;
                gap: 10px;
            }
            .filtros label, .filtros select {
                width: 100%;
                text-align: center;
            }

            table thead {
                display: none;
            }

            table, tbody, tr, td {
                display: block;
                width: 100%;
                border: none;
                text-align: left;
            }

            tr {
                border-bottom: 2px solid #dc3545;
                margin-bottom: 15px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                border-radius: 5px;
                background-color: #fff;
            }

            td {
                padding: 12px;
                position: relative;
                padding-left: 100px;
            }

            td::before {
                content: attr(data-label);
                position: absolute;
                left: 12px;
                top: 50%;
                transform: translateY(-50%);
                font-weight: bold;
                color: #555;
                text-align: left;
                width: 80px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-container">
            <img src="arena2.png" alt="Logo Arena Competidor" class="logo">
        </div>
    </div>

    <div class="main-container">
        <div class="checagem-container">
            <h1>Lista de Atletas por Categoria</h1>

            <div class="filtros">
                <div>
                    <label for="peso-filtro">Peso:</label>
                    <select id="peso-filtro"></select>
                </div>
            </div>

            <div id="categorias">
            </div>
        </div>
    </div>

    <script>
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZQSnHrELe0fIBczmqwlFgnovIXSR7LDcdVWyecazTGrp6TBl3ceVXLP-MS-A4xXEWPvAdodUXZygS/pub?output=csv';
        
        let atletas = [];

        async function carregarDados() {
            try {
                const response = await fetch(sheetUrl);
                const csvData = await response.text();
                
                const parseCSV = (csv) => {
                    const records = [];
                    const lines = csv.split('\n');
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                
                        const values = [];
                        let inQuote = false;
                        let current = '';
                
                        for (let j = 0; j < line.length; j++) {
                            const char = line[j];
                            if (char === '"' && (j === 0 || line[j - 1] === ',')) {
                                inQuote = true;
                            } else if (char === '"' && (j === line.length - 1 || line[j + 1] === ',')) {
                                inQuote = false;
                            } else if (char === ',' && !inQuote) {
                                values.push(current.trim());
                                current = '';
                            } else {
                                current += char;
                            }
                        }
                        values.push(current.trim());
                
                        if (values.length >= 8) {
                            records.push({
                                nome: values[1],
                                equipe: values[2],
                                professor: values[3],
                                faixa: values[4],
                                categoria: values[5],
                                peso: values[6],
                                sexo: values[7]
                            });
                        }
                    }
                    return records;
                };

                atletas = parseCSV(csvData);
                
                if (atletas.length === 0) {
                    document.getElementById('categorias').innerHTML = '<p style="text-align:center;">Nenhum atleta encontrado na planilha. Certifique-se de que a planilha não está vazia.</p>';
                    return;
                }
                
                preencherFiltros(atletas);
                aplicarFiltros();

            } catch (error) {
                console.error("Erro ao carregar os dados da planilha:", error);
                const container = document.getElementById('categorias');
                container.innerHTML = '<p style="text-align:center;">Não foi possível carregar a lista de atletas. Verifique se o link da planilha está correto e se ela foi publicada para acesso público.</p>';
            }
        }

        // Função de agrupamento de peso mais flexível
        function getPesoCombinado(peso) {
            if (!peso) return 'OUTROS';
            const pesoLower = peso.toLowerCase();
            
            if (pesoLower.includes('galo') || pesoLower.includes('pluma') || pesoLower.includes('pena')) {
                return 'LEVE';
            } else if (pesoLower.includes('leve') || pesoLower.includes('médio') || pesoLower.includes('meio-pesado')) {
                return 'MÉDIO';
            } else if (pesoLower.includes('pesado') || pesoLower.includes('super-pesado') || pesoLower.includes('pesadíssimo')) {
                return 'PESADO';
            }
            return 'OUTROS';
        }
        
        // Função de agrupamento de categoria mais flexível
        function getCategoriaCombinada(atleta) {
            const faixaLower = atleta.faixa.toLowerCase();
            const categoriaLower = atleta.categoria.toLowerCase();
            let categoriaFinal = '';

            if (faixaLower.includes('branca') || faixaLower.includes('cinza')) {
                categoriaFinal = 'Branca / Cinza';
            } else if (faixaLower.includes('amarela') || faixaLower.includes('laranja')) {
                categoriaFinal = 'Amarela / Laranja';
            } else if (faixaLower.includes('verde')) {
                categoriaFinal = 'Verde';
            } else if (faixaLower.includes('azul') || faixaLower.includes('roxa')) {
                categoriaFinal = 'Azul / Roxa';
            } else if (faixaLower.includes('marrom') || faixaLower.includes('preta')) {
                categoriaFinal = 'Marrom / Preta';
            } else {
                categoriaFinal = atleta.faixa;
            }

            if (categoriaLower.includes('adulto') || categoriaLower.includes('master')) {
                return `${categoriaFinal} Adulto / Master`;
            } else {
                return `${categoriaFinal} ${atleta.categoria}`;
            }
        }

        function preencherFiltros(atletas) {
            const pesosCombinadosUnicos = [...new Set(atletas.map(a => getPesoCombinado(a.peso)))].sort();
            const pesoFiltro = document.getElementById('peso-filtro');
            preencherSelect(pesoFiltro, pesosCombinadosUnicos);
            pesoFiltro.addEventListener('change', aplicarFiltros);
        }

        function preencherSelect(selectElement, options) {
            selectElement.innerHTML = '<option value="Todos">Todos</option>';
            options.forEach(option => {
                const opt = document.createElement('option');
                opt.value = option;
                opt.textContent = option;
                selectElement.appendChild(opt);
            });
        }
        
        function aplicarFiltros() {
            const pesoSelecionado = document.getElementById('peso-filtro').value;
            
            const atletasFiltrados = atletas.filter(atleta => {
                const pesoMatch = pesoSelecionado === 'Todos' || getPesoCombinado(atleta.peso) === pesoSelecionado;
                return pesoMatch;
            });
            
            renderizarCategorias(atletasFiltrados);
        }

        function renderizarCategorias(atletasParaRenderizar) {
            const container = document.getElementById('categorias');
            container.innerHTML = '';
            
            if (atletasParaRenderizar.length === 0) {
                container.innerHTML = '<p style="text-align:center;">Nenhum atleta encontrado com os filtros selecionados.</p>';
                return;
            }

            const gruposPorSexo = {};
            atletasParaRenderizar.forEach(atleta => {
                const sexo = atleta.sexo;
                if (!gruposPorSexo[sexo]) {
                    gruposPorSexo[sexo] = {};
                }
                
                const chaveCategoria = `${getCategoriaCombinada(atleta)} - ${getPesoCombinado(atleta.peso)}`;
                if (!gruposPorSexo[sexo][chaveCategoria]) {
                    gruposPorSexo[sexo][chaveCategoria] = [];
                }
                gruposPorSexo[sexo][chaveCategoria].push(atleta);
            });
            
            for (const sexo in gruposPorSexo) {
                if (gruposPorSexo.hasOwnProperty(sexo)) {
                    const sexoTitulo = document.createElement('h2');
                    sexoTitulo.className = 'sexo-title';
                    sexoTitulo.textContent = sexo.toUpperCase();
                    container.appendChild(sexoTitulo);
                    
                    const gruposDaFaixa = gruposPorSexo[sexo];
                    const chavesOrdenadas = Object.keys(gruposDaFaixa).sort();

                    chavesOrdenadas.forEach(chave => {
                        const categoriaTitulo = document.createElement('h3');
                        categoriaTitulo.className = 'category-title';
                        categoriaTitulo.textContent = chave.toUpperCase();
                        container.appendChild(categoriaTitulo);
                        
                        const tabela = document.createElement('table');
                        tabela.innerHTML = `
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Equipe</th>
                                    <th>Professor</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        `;
                        
                        const tbody = tabela.querySelector('tbody');
                        gruposDaFaixa[chave].forEach(atleta => {
                            const tr = document.createElement('tr');
                            tr.innerHTML = `
                                <td data-label="Nome">${atleta.nome}</td>
                                <td data-label="Equipe">${atleta.equipe}</td>
                                <td data-label="Professor">${atleta.professor}</td>
                            `;
                            tbody.appendChild(tr);
                        });
                        
                        container.appendChild(tabela);
                    });
                }
            }
        }
        
        carregarDados();
    </script>
</body>
</html>
